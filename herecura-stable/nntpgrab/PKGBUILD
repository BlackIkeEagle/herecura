# Maintainer: BlackEagle < ike DOT devolder AT gmail DOT com >

pkgbase=nntpgrab
pkgname=('nntpgrab-gtk' 'nntpgrab-qt')
pkgver=0.6.90
pkgrel=2
pkgdesc="NNTPGrab is an open source usenet download program"
arch=('i686' 'x86_64')
url="http://www.nntpgrab.nl/"
license="gpl2"
makedepends=('gtk2' 'libsoup' 'networkmanager' 'qt'
'pkgconfig' 'gtk-doc' 'par2cmdline' 'intltool' 'gobject-introspection' 'gconf')
options=('!libtool')
source=("http://openftd.mirrors.sebsoft.nl/${pkgbase}/${pkgbase}-${pkgver}.tar.bz2"
	'nntpgrab_0_6_90_commit1722.patch'
	'nntpgrab_0_6_90_commit1728.patch')
sha256sums=('d761b4f93b0ef3d961d154dbe31f41c35a32a87e4a392520d5e6f93cf7a0490e'
            'b0455afc4541e7bd6ccd4f693b1619c1beaa39d5676357d9b910533ef4875481'
			'e287c906117499e19a943a8e4aa09e3f902c1299d6d83e7e51ede832f3e05e5d')

build()
{
	cd ${pkgbase}-${pkgver}
	patch -Np0 -i ${srcdir}/nntpgrab_0_6_90_commit1722.patch
	patch -Np0 -i ${srcdir}/nntpgrab_0_6_90_commit1728.patch

	./configure\
		--enable-introspection=no\
		--enable-gtk-doc=no\
		--enable-gtk-doc-html=no\
		--enable-gtk-doc-pdf=no\
		--prefix=/usr
	make

	pushd client/gui_qt
		qmake gui_qt.pro -o Makefile
		make
	popd

	pushd server_qt
		qmake server_qt.pro -o Makefile
		make
	popd
}

package_nntpgrab-gtk() {
	pkgdesc="NNTPGrab is an open source usenet download program"
	depends=('gtk2' 'libsoup' 'networkmanager')
	optdepends=('par2cmdline: for automatic repair'
		'unrar: for automatic extraction')
	cd ${pkgbase}-${pkgver}
	make DESTDIR=${pkgdir} install
}

package_nntpgrab-qt() {
	pkgdesc="NNTPGrab is an open source usenet download program qt version"
	depends=('nntpgrab-gtk' 'qt')
	optdepends=('par2cmdline: for automatic repair'
		'unrar: for automatic extraction')
	cd ${pkgbase}-${pkgver}
	mkdir -p ${pkgdir}/usr/bin
	mkdir -p ${pkgdir}/usr/share/applications
	install -m 0755 client/gui_qt/nntpgrab_gui_qt ${pkgdir}/usr/bin/nntpgrab_gui_qt
	mkdir -p ${pkgdir}/usr/share/nntpgrab/translations/
	install -m 0644 client/gui_qt/translations/*.qm ${pkgdir}/usr/share/nntpgrab/translations
	install -m 0644 client/gui_qt/nntpgrab_qt.desktop ${pkgdir}/usr/share/applications/nntpgrab_qt.desktop
	install -m 0755 server_qt/nntpgrab_server_qt ${pkgdir}/usr/bin/nntpgrab_server_qt
	install -m 0644 server_qt/nntpgrab_server_qt.desktop ${pkgdir}/usr/share/applications/nntpgrab_server_qt.desktop
}
