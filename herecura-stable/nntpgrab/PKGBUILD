# Maintainer: BlackEagle < ike DOT devolder AT gmail DOT com >

pkgbase=nntpgrab
pkgname=('nntpgrab-gtk' 'nntpgrab-qt')
pkgver=0.6.91
pkgrel=2
pkgdesc="NNTPGrab is an open source usenet download program"
arch=('i686' 'x86_64')
url="http://www.nntpgrab.nl/"
license="gpl2"
makedepends=('gtk2' 'libsoup' 'networkmanager' 'qt'
'pkgconfig' 'par2cmdline' 'intltool')
options=('!libtool')
source=("http://openftd.mirrors.sebsoft.nl/${pkgbase}/${pkgbase}-${pkgver}.tar.bz2"
	"nntpgrab_0_6_91_support_older_qt_versions.patch"
	"nntpgrab_0_6_91_use_bundled_qtsolutions.patch")
sha256sums=('fea58723bbf01e68c1a80c59c3d148ccf1e934c0ed4c97bf3ccc5ebeea19b806'
            '74fb21b9d532d4ec6699bcb5147c68502bff55f6f4de84e0411ed727bd5d1e62'
            '6483d1d1cd9f4e02259e4ffb4916a2e31fcf76f30eb7d2ac2ba792df284a3305')

build()
{
	cd ${pkgbase}-${pkgver}
	patch -Np0 -i ${srcdir}/nntpgrab_0_6_91_support_older_qt_versions.patch
	patch -Np0 -i ${srcdir}/nntpgrab_0_6_91_use_bundled_qtsolutions.patch

	./configure\
		--enable-introspection=no \
		--enable-gtk-doc=no \
		--enable-gtk-doc-html=no \
		--enable-gtk-doc-pdf=no \
		--disable-gtk3 \
		--prefix=/usr
	make

	pushd client/gui_qt
		qmake gui_qt.pro -o Makefile
		make
	popd

	pushd server_qt
		qmake server_qt.pro -o Makefile
		make
	popd
}

package_nntpgrab-gtk() {
	pkgdesc="NNTPGrab is an open source usenet download program"
	depends=('gtk2' 'libsoup' 'networkmanager' 'desktop-file-utils')
	optdepends=('par2cmdline: for automatic repair'
		'unrar: for automatic extraction')
	install='nntpgrab.install'
	cd ${pkgbase}-${pkgver}
	make DESTDIR=${pkgdir} install
}

package_nntpgrab-qt() {
	pkgdesc="NNTPGrab is an open source usenet download program qt version"
	depends=('nntpgrab-gtk' 'qt')
	optdepends=('par2cmdline: for automatic repair'
		'unrar: for automatic extraction')
	install='nntpgrab.install'
	cd ${pkgbase}-${pkgver}
	mkdir -p ${pkgdir}/usr/bin
	mkdir -p ${pkgdir}/usr/share/applications
	install -m 0755 client/gui_qt/nntpgrab_gui_qt ${pkgdir}/usr/bin/nntpgrab_gui_qt
	mkdir -p ${pkgdir}/usr/share/nntpgrab/translations/
	install -m 0644 client/gui_qt/translations/*.qm ${pkgdir}/usr/share/nntpgrab/translations
	install -m 0644 client/gui_qt/nntpgrab_qt.desktop ${pkgdir}/usr/share/applications/nntpgrab_qt.desktop
	install -m 0755 server_qt/nntpgrab_server_qt ${pkgdir}/usr/bin/nntpgrab_server_qt
	install -m 0644 server_qt/nntpgrab_server_qt.desktop ${pkgdir}/usr/share/applications/nntpgrab_server_qt.desktop
}
