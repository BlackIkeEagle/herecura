# Contributor: PirateJonno <j@skurvy.no-ip.org>
# Contributor: Biginoz <biginoz _at_ free _point_ fr>
pkgname=plymouth
pkgver=0.8.3
pkgrel=6
pkgdesc="A graphical boot splash screen with kernel mode-setting support."
arch=('i686' 'x86_64')
url="http://freedesktop.org/wiki/Software/Plymouth"
license=('GPL')
depends=('initscripts' 'libdrm' 'gtk2')
makedepends=()
conflicts=('bootsplash' 'gensplash' 'fbsplash' 'splashy')
options=('!libtool' '!emptydirs')
install=plymouth.install
source=("http://www.freedesktop.org/software/${pkgname}/releases/${pkgname}-${pkgver}.tar.bz2"
	'plymouth-update-initrd'
	'plymouth-encrypt.initcpio_hook'
	'plymouth-encrypt.initcpio_install'
	'plymouth.functions'
	'plymouth.initcpio_hook'
	'plymouth.initcpio_install'
	'arch-logo.png'
	'system-release')
md5sums=('e59b4f04816fcbe506e9d4b725cb1e29'
         'f9418c98f84f948ccc860c08cf4177ed'
         'f218e7e4c6b27c5c2135a3de076d8b1a'
         '916fb026be911d4cf9c51d44bfee0791'
         '86c85dcf88dfdb6b895f72bdca1babd1'
         '3f7e1a50984788082e60a82931e1a21a'
         '9508a1adaac3641a0e6e6eb1155beb2f'
         'ab8a557d10f74bec5c94ed6cae34729c')
build() {
	cd "$srcdir/${pkgname}-${pkgver}"
	sed -e 's:png_set_gray_1_2_4_to_8:png_set_expand_gray_1_2_4_to_8:g' -i src/libply-splash-graphics/ply-image.c
	./configure --prefix=/usr --sysconfdir=/etc --localstatedir=/var --libexecdir=/usr/lib \
		--enable-tracing \
		--enable-tests \
		--with-system-root-install \
		--disable-tests \
		--enable-gdm-transition \
		--without-rhgb-compat-link \
		--with-logo=/usr/share/plymouth/arch-logo.png \
		--with-background-start-color-stop=0x000000 \
		--with-background-end-color-stop=0x4D4D4D

	
	make
}

package() {
	make DESTDIR=$pkgdir install
	
	cd $pkgdir

	find . -name "*.orig" -delete

	install -D -m755 "$srcdir/plymouth-update-initrd" ${pkgdir}/usr/lib/plymouth
	install -D -m644 $srcdir/plymouth.initcpio_install ${pkgdir}/lib/initcpio/install/plymouth
	install -D -m644 $srcdir/plymouth.initcpio_hook ${pkgdir}/lib/initcpio/hooks/plymouth
	install -D -m644 $srcdir/plymouth-encrypt.initcpio_install ${pkgdir}/lib/initcpio/install/plymouth-encrypt
	install -D -m644 $srcdir/plymouth-encrypt.initcpio_hook ${pkgdir}/lib/initcpio/hooks/plymouth-encrypt
	install -D -m644 $srcdir/plymouth.functions ${pkgdir}/etc/rc.d/functions.d/plymouth.functions
	install -D -m644 "$srcdir/arch-logo.png" ${pkgdir}/usr/share/plymouth/arch-logo.png
	install -D -m644 "$srcdir/system-release" ${pkgdir}/etc/system-release
}
