#Maintainer: Mathias Stearn <mathias@10gen.com>
#Contributor: Alec Thomas
pkgname=mongodb
pkgver=1.6.0
pkgrel=2
pkgdesc="A high-performance, open source, schema-free document-oriented database."
arch=('i686' 'x86_64')
url="http://www.mongodb.org"
license=('AGPL')
makedepends=(gcc scons boost)
depends=(boost-libs spidermonkey pcre)
optdepends=('libpcap: needed for mongosniff')
backup=('etc/conf.d/mongodb' 'etc/mongodb.conf')
source=("http://downloads.mongodb.org/src/${pkgname}-src-r${pkgver}.tar.gz"
        "mongodb.rc"
        "mongodb.conf")
md5sums=('d09e062b518ce71106652eac0e88a962'
         'ebc707d3348c1f908166847040153620'
         '9e0ea3f96732bb7811f0b64dace56440')
install="mongodb.install"

build() {
    local SCONSFLAGS="$MAKEFLAGS"

    cd "${pkgname}-src-r${pkgver}"

    scons --pch all || return 1
}

package() {
    cd "${pkgname}-src-r${pkgver}"

    scons --pch install --prefix="$pkgdir/usr" || return 1

    install -Dm 755 "$startdir/mongodb.rc" "$pkgdir/etc/rc.d/mongodb"
    install -Dm 644 "$startdir/mongodb.conf" "$pkgdir/etc/mongodb.conf"
    install -dm 700 "$pkgdir/var/state/mongodb"

    if [ -d "$pkgdir/usr/lib64" ]
    then
        mv "$pkgdir/usr/lib64" "$pkgdir/usr/lib"
    fi
}
