# Contributor: Ralf Barth <archlinux dot or at haggy dot org>

pkgname=xbmc-skin-mediastream-svn
pkgver=2675
pkgrel=2
pkgdesc="MediaStream skin for XBMC"
arch=('any')
url="http://www.teamrazorfish.co.uk/mediastream.html"
source=('build.diff')
depends=('xbmc-svn')
makedepends=('subversion')
provides=()
groups=('multimedia')
license=('GPL')
md5sums=('3a90e8effb67e237174eab27ed5f2460')
options=()

# Having these outside of the build() means the pkgver gets updated.
_svntrunk=http://xboxmediacenter.svn.sourceforge.net/svnroot/xboxmediacenter/MediaStream/
_svnmod=MediaStream

build() {
    ##Checkout or update source tree
    if [ -d $_svnmod/.svn ]; then
      (cd $_svnmod && svn up -r $pkgver)
    else
      svn co $_svntrunk --config-dir ./ -r $pkgver $_svnmod
    fi
    msg "SVN checkout done or server timeout"
    rm -rf ${srcdir}/${_svnmod}-build
    cp -a ${srcdir}/${_svnmod} ${srcdir}/${_svnmod}-build

    cd ${srcdir}/${_svnmod}-build
    patch -Np1 -i ${srcdir}/build.diff

    chmod +x ./build.sh
    msg "Please wait while TexturePacker builds the skin for you..."
    ./build.sh || return 1

    ##Copy tree to share location
    mkdir -p $pkgdir/usr/share/xbmc/addons
    cp -r ${srcdir}/${_svnmod}-build/BUILD/${_svnmod} ${pkgdir}/usr/share/xbmc/addons/skin.${_svnmod}
	# Remove SVN leftovers
	find ${pkgdir}/usr/share/xbmc/addons/skin.${_svnmod} -type d -name ".svn"|xargs rm -rf
}
